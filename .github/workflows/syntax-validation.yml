name: Syntax Validation

# Automated syntax validation for all shell scripts and workflow shell blocks
# Prevents syntax errors from being merged into the repository

on:
  pull_request:
    branches: [main]
    paths:
      - '**/*.sh'
      - '.github/workflows/**/*.yml'
      - '.github/workflows/**/*.yaml'
      - '.github/actions/**/*.yml'
      - '.github/actions/**/*.yaml'
  push:
    branches: [main]
    paths:
      - '**/*.sh'
      - '.github/workflows/**/*.yml'
      - '.github/workflows/**/*.yaml'
      - '.github/actions/**/*.yml'
      - '.github/actions/**/*.yaml'

jobs:
  validate-syntax:
    name: "Validate Shell Syntax"
    runs-on: ubuntu-latest
    
    steps:
      - name: "Checkout Repository"
        uses: actions/checkout@v4
        
      - name: "Install Dependencies"
        run: |
          # Install yq for better YAML parsing
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq
          
          # Verify installations
          yq --version
          python3 --version
          
      - name: "Validate Shell Scripts"
        run: |
          echo "üîç Validating shell scripts..."
          find . -name "*.sh" -type f | while read -r script; do
            echo "Checking: $script"
            if ! bash -n "$script"; then
              echo "‚ùå Syntax error in $script"
              exit 1
            fi
          done
          echo "‚úÖ All shell scripts passed syntax validation"
          
      - name: "Validate Workflow Shell Blocks"
        run: |
          chmod +x validate-workflows.sh
          ./validate-workflows.sh
          
      - name: "Summary"
        if: success()
        run: |
          echo "‚úÖ All syntax validation checks passed!"
          echo "üîí No syntax errors found in shell scripts or workflow shell blocks"
